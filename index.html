<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AI Friend ‚Äì Character Creator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f1014;
      color: #fff;
    }
    .app {
      padding: 16px;
      box-sizing: border-box;
    }
    h1 {
      margin-top: 0;
      font-size: 22px;
    }
    h2 {
      margin-top: 24px;
      font-size: 18px;
    }
    .field {
      display: flex;
      flex-direction: column;
      margin-bottom: 10px;
    }
    label {
      font-size: 13px;
      margin-bottom: 4px;
      opacity: 0.9;
    }
    select,
    input,
    textarea {
      border-radius: 8px;
      border: none;
      padding: 8px 10px;
      font-size: 14px;
      outline: none;
      background: #1b1c23;
      color: #fff;
    }
    textarea {
      resize: vertical;
    }
    button.main {
      width: 100%;
      margin-top: 16px;
      padding: 10px 14px;
      font-size: 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #2b8cff;
      color: #fff;
      font-weight: 600;
    }
    .hint {
      font-size: 12px;
      opacity: 0.7;
      margin-bottom: 8px;
    }
    .error {
      font-size: 12px;
      color: #ff6b6b;
      margin-top: 10px;
      min-height: 16px;
    }

    /* –ß–∏–ø—ã-–∫–Ω–æ–ø–∫–∏ –¥–ª—è –º—É–ª—å—Ç–∏–≤—ã–±–æ—Ä–∞ */
    .chip-group {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 4px;
    }
    .chip {
      border: 1px solid #2b8cff;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 13px;
      background: #1b1c23;
      color: #d0d0ff;
      cursor: pointer;
      user-select: none;
      flex: 0 1 calc(50% - 8px); /* –ø—Ä–∏–º–µ—Ä–Ω–æ 2 –≤ —Ä—è–¥ –Ω–∞ –º–æ–±–∏–ª–µ */
      text-align: center;
      box-sizing: border-box;
    }
    @media (min-width: 480px) {
      .chip {
        flex: 0 1 calc(33.33% - 8px); /* –Ω–∞ —á—É—Ç—å –±–æ–ª—å—à–∏—Ö –º–æ–∂–Ω–æ 3 –≤ —Ä—è–¥ */
      }
    }
    .chip.selected {
      background: #2b8cff;
      color: #fff;
    }
  </style>
</head>
<body>
  <div class="app">
    <h1>Character creator üé®</h1>

    <!-- –ë–õ–û–ö 1: —Ç–∏–ø –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏ –≥–µ–Ω–¥–µ—Ä –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ -->
    <h2>Relationship & gender</h2>

    <div class="field">
      <label>Relationship type</label>
      <select id="relationship_type">
        <option value="romantic">Romantic</option>
        <option value="friend">Just a friend</option>
      </select>
      <div class="hint">Romantic = flirty, Friend = no romance.</div>
    </div>

    <div class="field">
      <label>Partner gender</label>
      <select id="partner_gender">
        <option value="female">Female</option>
        <option value="male">Male</option>
      </select>
    </div>

    <!-- –ë–õ–û–ö 2: –≤–Ω–µ—à–Ω–æ—Å—Ç—å -->
    <h2>Appearance</h2>

    <div class="field">
      <label>Character gender (look)</label>
      <select id="appearance_gender">
        <option value="female">Female</option>
        <option value="male">Male</option>
        <option value="androgynous">Androgynous</option>
      </select>
    </div>

    <div class="field">
      <label>Ethnicity</label>
      <select id="ethnicity">
        <option value="caucasian">Caucasian</option>
        <option value="european">European</option>
        <option value="latina">Latina</option>
        <option value="asian">Asian</option>
        <option value="indian">Indian</option>
        <option value="arab">Arab</option>
        <option value="black">Black / Afro</option>
      </select>
    </div>

    <div class="field">
      <label>Age range</label>
      <select id="age">
        <option value="18-20">18‚Äì20</option>
        <option value="20s">20s</option>
        <option value="30s">30s</option>
        <option value="40-55">40‚Äì55</option>
        <option value="55+">55+</option>
      </select>
    </div>

    <div class="field">
      <label>Eye color</label>
      <select id="eye_color">
        <option value="brown">Brown</option>
        <option value="blue">Blue</option>
        <option value="green">Green</option>
      </select>
    </div>

    <div class="field">
      <label>Hair style</label>
      <select id="hair_style">
        <option value="straight">Straight</option>
        <option value="braids">Braids</option>
        <option value="bangs">Bangs</option>
        <option value="curly">Curly</option>
        <option value="bun">Bun</option>
        <option value="short">Short</option>
        <option value="long">Long</option>
        <option value="ponytail">Ponytail</option>
        <option value="pigtails">Pigtails</option>
      </select>
    </div>

    <div class="field">
      <label>Hair color</label>
      <select id="hair_color">
        <option value="blonde">Blonde</option>
        <option value="brown">Brown</option>
        <option value="black">Black</option>
        <option value="gray">Gray</option>
        <option value="white">White</option>
        <option value="red">Red</option>
        <option value="pink">Pink</option>
        <option value="blue">Blue</option>
      </select>
    </div>

    <div class="field">
      <label>Style / vibe</label>
      <select id="style">
        <option value="casual">Casual</option>
        <option value="cute">Cute</option>
        <option value="sexy">Sexy</option>
        <option value="sporty">Sporty</option>
        <option value="elegant">Elegant</option>
      </select>
    </div>

    <div class="field">
      <label>Appearance note (optional)</label>
      <textarea
        id="appearance_note"
        rows="3"
        placeholder="Optional: Long dark hair, soft smile, natural makeup."></textarea>
    </div>

    <!-- –ë–õ–û–ö 3: –ª–∏—á–Ω–æ—Å—Ç—å -->
    <h2>Personality</h2>

    <div class="field">
      <label>Character name</label>
      <input id="name" type="text" placeholder="Sofia, Alex." autocomplete="off" />
    </div>

    <div class="field">
      <label>Age (for profile)</label>
      <input
        id="age_display"
        type="number"
        min="18"
        max="80"
        value="24"
        inputmode="numeric" />
    </div>

    <div class="field">
      <label>Personality traits (tap to select)</label>
      <div class="chip-group" id="traits_group">
        <div class="chip" data-value="Sage">Sage</div>
        <div class="chip" data-value="Innocent">Innocent</div>
        <div class="chip" data-value="Lover">Lover</div>
        <div class="chip" data-value="Experimenter">Experimenter</div>
        <div class="chip" data-value="Submissive">Submissive</div>
        <div class="chip" data-value="Dominant">Dominant</div>
        <div class="chip" data-value="Confidant">Confidant</div>
        <div class="chip" data-value="Caregiver">Caregiver</div>
        <div class="chip" data-value="Temptress">Temptress</div>
        <div class="chip" data-value="Playful">Playful</div>
      </div>
    </div>

    <div class="field">
      <label>Interests & hobbies (tap multiple)</label>
      <div class="chip-group" id="interests_group">
        <div class="chip" data-value="Fitness">Fitness</div>
        <div class="chip" data-value="Cosplay">Cosplay</div>
        <div class="chip" data-value="Vlogging">Vlogging</div>
        <div class="chip" data-value="Martial Arts">Martial Arts</div>
        <div class="chip" data-value="Anime">Anime</div>
        <div class="chip" data-value="Art">Art</div>
        <div class="chip" data-value="Traveling">Traveling</div>
        <div class="chip" data-value="Series">Series</div>
        <div class="chip" data-value="Watching Netflix">Watching Netflix</div>
        <div class="chip" data-value="Hiking">Hiking</div>
        <div class="chip" data-value="Gaming">Gaming</div>
        <div class="chip" data-value="Writing">Writing</div>
        <div class="chip" data-value="Self-Development">Self-Development</div>
        <div class="chip" data-value="DIY Crafting">DIY Crafting</div>
        <div class="chip" data-value="Spirituality">Spirituality</div>
        <div class="chip" data-value="Esoterics">Esoterics</div>
      </div>
    </div>

    <div class="field">
      <label>Occupation (tap one)</label>
      <div class="chip-group" id="occupation_group">
        <div class="chip" data-value="Student">Student</div>
        <div class="chip" data-value="Doctor">Doctor</div>
        <div class="chip" data-value="Nurse">Nurse</div>
        <div class="chip" data-value="Teacher">Teacher</div>
        <div class="chip" data-value="Lawyer">Lawyer</div>
        <div class="chip" data-value="Designer">Designer</div>
        <div class="chip" data-value="Photographer">Photographer</div>
        <div class="chip" data-value="Artist">Artist</div>
        <div class="chip" data-value="Model">Model</div>
        <div class="chip" data-value="Singer/Musician">Singer/Musician</div>
        <div class="chip" data-value="Fitness Coach">Fitness Coach</div>
        <div class="chip" data-value="Writer">Writer</div>
        <div class="chip" data-value="Chef/Cook">Cook</div>
        <div class="chip" data-value="Flight Attendant">Flight Attendant</div>
      </div>
    </div>

    <button id="save_btn" class="main">Save and send to bot ‚úÖ</button>
    <div id="error" class="error"></div>
  </div>

  <script>
    const tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;

    if (tg) {
      tg.ready();
      tg.expand();
      if (typeof tg.isVersionAtLeast === "function" && tg.isVersionAtLeast("7.7")) {
        tg.disableVerticalSwipes();
      }
    }

    // –£–¥–∞–ª—è–µ–º –ª—é–±—ã–µ –±—É–∫–≤—ã –∏–∑ –≤–æ–∑—Ä–∞—Å—Ç–∞
    const ageInput = document.getElementById("age_display");
    ageInput.addEventListener("input", (e) => {
      e.target.value = e.target.value.replace(/[^\d]/g, "");
    });

    const errorBox = document.getElementById("error");

    function showError(message, focusId) {
      errorBox.textContent = message;
      errorBox.style.display = "block";
      if (focusId) {
        const el = document.getElementById(focusId);
        if (el) {
          el.focus();
          try {
            el.scrollIntoView({ behavior: "smooth", block: "center" });
          } catch (e) {}
        }
      }
    }

    function clearError() {
      errorBox.textContent = "";
      errorBox.style.display = "block"; // —á—Ç–æ–±—ã –º–µ—Å—Ç–æ –ø–æ–¥ –æ—à–∏–±–∫—É –Ω–µ –ø—Ä—ã–≥–∞–ª–æ
    }

    // –ß–∏–ø—ã: –º—É–ª—å—Ç–∏–≤—ã–±–æ—Ä
    function setupMultiChipGroup(groupId) {
      const group = document.getElementById(groupId);
      if (!group) return;
      group.addEventListener("click", (e) => {
        const chip = e.target.closest(".chip");
        if (!chip) return;
        chip.classList.toggle("selected");
      });
    }

    // –ß–∏–ø—ã: –æ–¥–∏–Ω–æ—á–Ω—ã–π –≤—ã–±–æ—Ä
    function setupSingleChipGroup(groupId) {
      const group = document.getElementById(groupId);
      if (!group) return;
      group.addEventListener("click", (e) => {
        const chip = e.target.closest(".chip");
        if (!chip) return;
        Array.from(group.querySelectorAll(".chip.selected")).forEach((c) =>
          c.classList.remove("selected")
        );
        chip.classList.add("selected");
      });
    }

    function getSelectedValuesFromGroup(groupId) {
      const group = document.getElementById(groupId);
      if (!group) return [];
      return Array.from(group.querySelectorAll(".chip.selected")).map((chip) => chip.dataset.value);
    }

    setupMultiChipGroup("traits_group");
    setupMultiChipGroup("interests_group");
    setupSingleChipGroup("occupation_group");

    document.getElementById("save_btn").addEventListener("click", () => {
      clearError();

      const relationship_type = document.getElementById("relationship_type").value;
      const partner_gender = document.getElementById("partner_gender").value;

      const name = document.getElementById("name").value.trim();
      const ageDisplayRaw = ageInput.value.trim();
      const ageDisplayNum = Number(ageDisplayRaw);

      if (!name) {
        showError("Please enter character name.", "name");
        return;
      }

      if (
        !ageDisplayRaw ||
        Number.isNaN(ageDisplayNum) ||
        ageDisplayNum < 18 ||
        ageDisplayNum > 80
      ) {
        showError("Please enter a valid age between 18 and 80.", "age_display");
        return;
      }

      const appearance = {
        gender: document.getElementById("appearance_gender").value,
        ethnicity: document.getElementById("ethnicity").value,
        age: document.getElementById("age").value,
        eye_color: document.getElementById("eye_color").value,
        hair_style: document.getElementById("hair_style").value,
        hair_color: document.getElementById("hair_color").value,
        style: document.getElementById("style").value,
        appearance_note: document.getElementById("appearance_note").value
      };

      const traits = getSelectedValuesFromGroup("traits_group");
      const interests = getSelectedValuesFromGroup("interests_group");
      const occupationArr = getSelectedValuesFromGroup("occupation_group");
      const occupation = occupationArr.length ? occupationArr[0] : null;

      const personality = {
        name,
        age_display: ageDisplayNum,
        traits,
        interests,
        occupation
      };

      const payload = {
        relationship_type,
        partner_gender,
        appearance,
        personality
      };

      if (tg) {
        tg.sendData(JSON.stringify(payload));
        tg.close();
      } else {
        console.log("Payload:", payload);
        showError("Test mode (not in Telegram) ‚Äì open in Telegram to send to bot.");
      }
    });
  </script>
</body>
</html>
